{% extends 'shop/basic.html' %}

{% block title %} ORDER Royal_Shetkari{% endblock %}

{% load static %}
{% block body %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{% static 'template/table_menu.css' %}">
    <style>
        .list-group-item {
            border-right:none;
            border-left:none;
            background-color:transparent;
        }
        .fa, .fas {
            padding: 12px;
            font-weight: 900;
        }
        .clear-cart{
            text-decoration:none;
            color:white;
        }
        .clear-cart:hover{
            text-decoration:none;
            color:#FAF9F6;

        }
    </style>
    
</head>
<main-body><br><br><br><br>
    <div id="notification" class="alert alert-primary" role="alert"></div><br>
    
    <div class="sidebar" id="sidebar">
        <div class="heading">
            <h2>MENU</h2>
        </div>
        {% for category, subcats in allProds %}
        <ul>
            <li>
                <a href="javascript:void(0)" class="category-link" data-category="{{ category }}">
                    {{ category|upper }}
                </a>
            </li>
            <ul class="subcategory-list" id="subcats-{{ category }}">
                {% for subcategory, products in subcats %}
                <li>
                    <a href="javascript:void(0)" class="subcategory-link" data-category="{{ category }}" data-subcategory="{{ subcategory }}">
                        {{ subcategory|title }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </ul>
        {% endfor %}
    </div>

    <div class="main-content" id="product-container">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search..." />
            <button id="search-btn">Search</button>
        </div>

        <div id="no-results-message"class="menu-items" style="display: none; color: red;">
            <center>No products matching this NAME.</center>
        </div>
        
        {% for category, subcats in allProds %}
    {% for subcategory, products in subcats %}
    <div class="category" data-subcategory="{{ subcategory }}" style="display: none;">
        {{ subcategory }}
        <div class="menu-items">
            {% for product in products %}
            <div class="menu-items">
                <div>
                    <!-- Hidden elements to store product name and price -->
                    <h5 id="namepr{{ product.id }}" class="product-name card-title" style="display:none;">{{ product.product_name }}</h5>
                    

                    <!-- Product button that will trigger the cart and play sound -->
                    <div id="divpr{{ product.id }}" class="divpr">
                        <div style="position: relative;">
                            <!-- Price displayed as non-clickable text -->
                            <h6 id="pricepr{{ product.id }}" style="color: #ff0000; font-size: 11px; position: absolute; top: -11px;left:77px;">
                                Rs. {{ product.price }} /-
                            </h6>
                        
                            <!-- Clickable button excluding the price -->
                            <button id="pr{{ product.id }}" class="menu-item cart" style="padding-top: 16px;">
                                {{ product.product_name }}
                                <!-- Colored span for category indication -->
                                <span style="
                                    position: absolute; 
                                    left: 0; 
                                    top: 0; 
                                    width: 5px; 
                                    height: 100%; 
                                    background-color: 
                                        {% if category == 'व्हेज / veg' %} #32de84 
                                        {% elif category == 'नॉनव्हेज / nonveg' %} red 
                                        {% endif %};
                                "></span>
                            </button>
                        </div>
                        
                    </div>
                </div>
            </div>
            <style>
                /* Notification background color based on category */
                #notification {
                    background-color: 
                        {% if category == 'व्हेज / veg' %} red 
                        {% elif category == 'nonveg' %} green 
                        {% endif %};
                }
            </style>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
{% endfor %}

    </div>



    <div class="container my-4" style="display:none;">
       <center> <h3>Cart Items</h3></center>
        <div id="cartItems" class="product-container"></div>
    </div>
    <style>
        .fa-search {
            font-size: 16px;
            padding: 0px;
        }
    </style>
    <div class="order-section">
        <div class="order-header">
            <div>
                <button id="refreshCart"><i class="fa fa-search" aria-hidden="true"></i> CHECK IN</button>
                <button>DELIVERY</button>
                <button>PICK UP</button>
            </div>
        </div>
        <div class="order-list">
            <ul class="list-group" id="items"></ul>
        </div>
        <div class="order-footer">
            <button id="clearCart">Clear Cart</button>
            <button id="refreshPage" class="btn btn-secondary">Final Check</button>
            <li class="list-group-item d-flex justify-content-between align-items-center" style="background: bisque;">
                <span>TOTAL PRICE:</span>
                <span class="badge badge-danger badge-pill" id="totalPrice">
                    <span style="font-size: 5px;">.</span> 0 /-
                </span>
                
            </li>
        </div>

    <!-- Form for Checkout -->
<form method="POST" action="{% url 'shop:checkout' %}" id="checkoutForm" onsubmit="return validatePaymentMethod();"style="margin:0px;">
    {% csrf_token %}
    <!-- Other input fields -->
    
    <input type="hidden" name="amount" value="{{ amount }}">  <!-- Ensure amount is set correctly -->
    
    <div class="order-footer-payment">
        <div class="payment-options">
            <label>
                <input type="radio" name="payment_method" value="cash"> Cash
            </label>
            <label>
                <input type="radio" name="payment_method" value="online"> Online
            </label>
            <label>
                <input type="radio" name="payment_method" value="card"> Card
            </label>
            <label>
                <input type="radio" name="payment_method" value="other"> Other
            </label>
        </div>
    
        <!-- Additional input for "Other" payment method -->
        <div id="payment_comments_container" style="display:none;">
            <label for="payment_comments">Comments :</label>
            <input type="text" name="payment_comments" id="payment_comments" class="form-control" placeholder="Enter comment">
        </div>
    </div>

    <div id="payment-alert" style="display: none; background-color: #d4edda; color: #155724; padding: 10px; border: 1px solid #c3e6cb;">
        Please choose a payment method!
    </div>

        <!-- Print Button -->
        
    
        {% if user.is_authenticated %}
        <div class="final-options">
            <form method="post" action="/shop/checkout/" id="checkoutForm" >
                {% csrf_token %}
                <input type="hidden" name="itemsJson" id="itemsJson">
                <input type="hidden" name="amount" id="amount">
                <input type="hidden" name="user_id" id="user_id" value="{{ request.user.id }}">
                
                <div class="print">
                    <button type="submit" name="action" value="save">Save</button>
                    <button class="btn btn-info" id="printCartItems"> Save & Print</button>
                </div>
            </form> 
        </form>
        
            <div class="print">
                <button id="printReceipt">Counter Print</button>
                <button type="submit" name="action" value="save_bill">Save & Bill</button>
                <button type="submit" name="action" value="kot">KOT</button>
                <button type="submit" name="action" value="kot_print">KOT & Print</button>
            </div>
        </div>
  

<!-- Modal for Payment Comments -->
<div id="commentModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background-color:white; margin:20% auto; padding:20px; width:300px; text-align:center; border-radius:5px;">
        <h3>Enter Your Comments</h3>
        <textarea id="modal_payment_comments" class="form-control" placeholder="Enter comments here..."></textarea>
        <br>
        <button id="submitComments" style="margin-top:10px;">Submit</button>
        <button onclick="closeModal()" style="margin-top:10px;">Cancel</button>
    </div>
</div>
        {% else %}
        <div id="cont2">
            <div class="alert alert-info">
                <font style="font-size:22px"><center>Before Save you need to <strong><a class="alert-link" data-toggle="modal" data-target="#loginModal">Login</a></strong></center></font>
            </div>
        </div>
        {% endif %}
</main-body>
<script src="{% static 'template/table_menu.js' %}"></script>
{% endblock %}

{% block js %}









{% comment %} print the bill  {% endcomment %}<script>
    function printCartItems() {
        let items = document.querySelectorAll('#items li');
        let totalPriceText = document.getElementById('totalPrice').innerText;

        // Open a new window for printing the receipt
        let printWindow = window.open('', 'Print Order', 'width=80mm,height=auto');
        printWindow.document.write('<html><head><title>RECEIPT OF ROYAL SHETKARI</title>');
        
        // Style for the receipt
        printWindow.document.write(`
            <style>
                @media print {
                    body {
                        width: 95%; 
                        font-family: 'Courier New', monospace;
                        padding: 10px;
                        margin: 0;
                        border: 2px dotted black;
                        line-height: 1.2;
                    }
                    h3, h4, h5 {
                        text-align: center;
                        margin: 5px 0;
                    }
                    h4 {
                        border-bottom: 1px solid black;
                        width: 99%;
                        margin-bottom: 10px;
                    }
                    .cart-item {
                        border-bottom: 1px dashed black;
                        padding-bottom: 5px;
                        margin-bottom: 5px;
                    }
                    .total {
                        font-weight: bold;
                        text-align: right;
                        padding: 5px 0;
                    }
                    .footer-text {
                    font-family: 'Courier New', monospace;
                        text-align: center;
                        margin-top: 10px;
                        border-top: 1px solid black;
                        padding-top: 5px;
                        position: fixed;
                        bottom: 10px; /* Ensure footer is at the bottom */
                        width: 100%;
                        left: 0;
                        right: 0;
                    }
                    
                }
            </style>
        `);

        printWindow.document.write('</head><body>');

        // Add company details
        printWindow.document.write('<h3>रॉयल शेतकरी</h3>');
        printWindow.document.write('<h5>प्रोप्रा. अभिजीत कोळवले</h5>');
        printWindow.document.write('<h5>मो. ९३७०७०२५८६</h5>');
        printWindow.document.write('<h5>तेजस अ‍ॅग्रो शेजारी, पंढरपूर-पुणे हायवे, भंडीशेगाव, ता. पंढरपूर, जि. सोलापूर</h5>');

        printWindow.document.write('<hr>');

        // Section for cart items
        printWindow.document.write('<h4>Your Cart Items</h4>');

        let subtotal = 0;
        let totalQuantity = 0;

        // Start content section
        printWindow.document.write('<div class="content">');

        // First loop: Print items once
        items.forEach((item, index) => {
            let itemName = item.querySelector('.item-name') ? item.querySelector('.item-name').innerText : 'Unknown';
            let itemQty = item.querySelector('.qty-input') ? parseInt(item.querySelector('.qty-input').value) : 0;
            let itemPrice = item.querySelector('.original-item-price') ? parseFloat(item.querySelector('.original-item-price').innerText.replace('Rs. ', '').trim()) : 0;

            if (itemName !== 'Unknown' && itemQty > 0) {
                let itemTotal = itemQty * itemPrice;
                subtotal += itemTotal;
                totalQuantity += itemQty;

                // Print each cart item with its index
                printWindow.document.write(`
                    <div class="cart-item">
                        <li>${index + 1}. ${itemName} x ${itemQty} @ Rs. ${itemPrice.toFixed(2)} 
                        <span class="amount"> = Rs. ${itemTotal.toFixed(2)}</span></li>
                    </div>
                `);
            }
        });

        // Total quantity and final price
        printWindow.document.write(`
            <p>Total Quantity: ${totalQuantity}</p>
            <p class="total">Total Price (with tax): Rs. ${totalPriceText}</p>
        `);

        printWindow.document.write('</div>'); // End content section

        // Footer message
        printWindow.document.write('<div class="footer-text">Visit Again! This software was developed by Prasad Yalmar.</div>');

        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }

    document.getElementById('printCartItems').addEventListener('click', printCartItems);
</script>












{% comment %} select payment method  {% endcomment %}
<script>
    function printCartItems() {
        let items = document.querySelectorAll('#items li');
        let totalPriceText = document.getElementById('totalPrice').innerText;

        let printWindow = window.open('', 'Print Order', 'width=600,height=400');
        printWindow.document.write('<html><head><title>RECEIPT OF ROYAL SHETKARI</title>');
        
        // Style for the receipt including custom footer and other styling
        printWindow.document.write(`
            <style>
                @media print {
                    body {
                        width: 140mm;
                        line-height: 1.2; /* Minimize gap between lines */
                        font-family: 'Courier New', monospace;
                        border: 2px dotted black; /* Dotted border for paper */
                        padding: 10px; /* Padding around the receipt */
                        margin: 0; /* Remove default margin */
                        height: auto; /* Ensure the height is minimized to fit content */
                    }
                    .logo-section {
                        text-align: center;
                        margin-bottom: 5px;
                    }
                    h3, h4, h5 {
                        margin: 2px 0; /* Minimize gap above and below headings */
                        text-align: center;
                    }
                    h4 {
                        margin-top: 8px;
                    }
                    .cart-item {
                        border-top: 1px solid black; /* Top border for the first product */
                        border-bottom: 1px solid black; /* Border for each product */
                        padding-bottom: 5px;
                        margin-bottom: 5px;
                    }
                    .total {
                        background-color: orange; /* Orange background for final total */
                        color: white;
                        padding: 5px;
                        font-weight: bold;
                    }
                    .amount {
                        color: green; /* Green color for product totals */
                    }
                    .footer-text {
                        text-align: center;
                        margin-top: 5px;
                        border: 2px solid black; 
                        padding: 5px;
                        border-radius: 25%;
                        display: inline-block; 
                        width: fit-content; 
                        margin-bottom: -10px; 
                    }
                }
            </style>
        `);
        
        printWindow.document.write('</head><body>');
        
        // Add logo and company name, centered
        printWindow.document.write('<div class="logo-section"><img src="https://www.yourcompany.com/logo.png" alt="Logo"></div>');
        printWindow.document.write('<h3>रॉयल शेतकरी</h3>');
        printWindow.document.write('<h5>प्रोप्रा. अभिजीत कोळवले</h5>');
        printWindow.document.write('<h5>मो. ९३७०७०२५८६</h5>');
        printWindow.document.write('<h5>तेजस अ‍ॅग्रो शेजारी, पंढरपूर-पुणे हायवे, भंडीशेगाव, ता. पंढरपूर, जि. सोलापूर </h5>');

        printWindow.document.write('<h4>Your Cart Items</h4>');

        let subtotal = 0;
        let totalQuantity = 0;

        // Add the product items with borders
        items.forEach((item, index) => {
            let itemName = item.querySelector('.item-name') ? item.querySelector('.item-name').innerText : 'Unknown';
            let itemQty = item.querySelector('.qty-input') ? parseInt(item.querySelector('.qty-input').value) : 0;
            let itemPrice = item.querySelector('.original-item-price') ? parseFloat(item.querySelector('.original-item-price').innerText.replace('Rs. ', '').trim()) : 0;

            if (itemName !== 'Unknown' && itemQty > 0) {
                let itemTotal = itemQty * itemPrice;
                subtotal += itemTotal;
                totalQuantity += itemQty;

                // Print each cart item with both Marathi and English separated
                let productNames = itemName.split('/');
                let marathiName = productNames[0] ? productNames[0].trim() : '';
                let englishName = productNames[1] ? productNames[1].trim() : '';

                printWindow.document.write(`
                    <div class="cart-item">
                        <li>${index + 1}. ${index + 1}: ${marathiName} / ${englishName} x ${itemQty} @ Rs. ${itemPrice.toFixed(2)} 
                        <span class="amount"> = Rs. ${itemTotal.toFixed(2)}</span></li>
                    </div>
                `);
            }
        });

        printWindow.document.write('<hr>');
        
        // Total quantity and final price with customized background and colors
        printWindow.document.write(`
            <p>Total Quantity: ${totalQuantity}</p>
            <p class="total">Total Price (with tax): Rs. ${totalPriceText}</p>
        `);

        printWindow.document.write('<p>Thank you for shopping with us!</p>');

        // Footer message with custom border and rounded design
        printWindow.document.write('<div class="footer-text">Visit Again! This software was developed by Prasad Yalmar.</div>');

        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }

    document.getElementById('printCartItems').addEventListener('click', printCartItems);

    // Payment method validation
    function validatePaymentMethod() {
        const paymentMethods = document.getElementsByName('payment_method');
        let isSelected = false;

        for (const method of paymentMethods) {
            if (method.checked) {
                isSelected = true;
                break;
            }
        }

        const alertDiv = document.getElementById('payment-alert');
        if (!isSelected) {
            alertDiv.style.display = 'block'; // Show alert if no payment method is selected
            return false; // Prevent form submission
        } else {
            alertDiv.style.display = 'none'; // Hide alert if a payment method is selected
            return true; // Allow form submission
        }
    }
</script>


       


<script>
    // Audio element for playing sound
var soundEffect_12 = new Audio("{% static 'sound/mausklick-82774.mp3' %}");

const paymentRadios = document.querySelectorAll('input[name="payment_method"]');
const paymentCommentsContainer = document.getElementById('payment_comments_container');
const paymentCommentsInput = document.getElementById('payment_comments');
const modal = document.getElementById('commentModal');
const modalCommentsInput = document.getElementById('modal_payment_comments');

paymentRadios.forEach(radio => {
    radio.addEventListener('change', function() {
        // Play the sound effect when a payment method is selected
        soundEffect_12.play();

        if (this.value === 'other') {
            modal.style.display = 'block'; // Show the modal for comments
        } else {
            paymentCommentsContainer.style.display = 'none';
            paymentCommentsInput.value = ''; // Clear the input if not "Other"
        }
    });
});


    // Close modal function
    function closeModal() {
        modal.style.display = 'none';
        modalCommentsInput.value = ''; // Clear the modal input when closed
    }

    // Submit comments from modal
    document.getElementById('submitComments').addEventListener('click', function() {
        const comments = modalCommentsInput.value.trim();
        if (comments) {
            paymentCommentsInput.value = comments; // Set the comments input
            closeModal(); // Close the modal
            paymentCommentsContainer.style.display = 'block'; // Show comments container
        } else {
            alert('Please enter a comment before submitting.');
        }
    });

    // Validation function
    function validatePaymentMethod() {
        const paymentMethods = document.getElementsByName('payment_method');
        let isSelected = false;

        for (const method of paymentMethods) {
            if (method.checked) {
                isSelected = true;
                break;
            }
        }

        const alertDiv = document.getElementById('payment-alert');
        if (!isSelected) {
            alertDiv.style.display = 'block'; // Show alert if no payment method is selected
            return false; // Prevent form submission
        } else {
            alertDiv.style.display = 'none'; // Hide alert if a payment method is selected
            return true; // Allow form submission
        }
    }
</script>



<script>
    // Get a unique identifier for each cart (based on the URL)
    function getCartKey() {
        var pathname = window.location.pathname; // e.g., /shop/1/
        return 'cart_' + pathname.replace(/\//g, '_'); // e.g., cart__shop_1_
    }

    // Initialize the cart based on the current URL or create a new one
    var cartKey = getCartKey();
    var cart = JSON.parse(localStorage.getItem(cartKey)) || {};

    // Function to update only the specific cart item UI
    function updateCartItem(itemId) {
        var [qty, name, itemPrice] = cart[itemId];
        var sumPrice = qty * itemPrice;

        // Update the item's quantity and total price in the UI
        $(`#val-${itemId}`).val(qty);
        $(`#price-${itemId}`).html(`Rs. ${sumPrice}`);

        // Update total cart price
        updateTotalPrice();
    }

    // Function to update the total price only
    function updateTotalPrice() {
        var totalPrice = 0;
        for (var item in cart) {
            var sumPrice = cart[item][0] * cart[item][2];
            totalPrice += sumPrice;
        }
        $('#totalPrice').html(`Rs. ${totalPrice}`);
        localStorage.setItem(cartKey, JSON.stringify(cart)); // Save cart with specific key
    }

    // Function to initialize the cart UI
    function initializeCart(cart) {
        var cartItems = '';

        for (var item in cart) {
            var [qty, name, itemPrice] = cart[item];
            var sumPrice = qty * itemPrice;

            cartItems += `
                <li class="order-item list-group-item d-flex justify-content-between align-items-center" id="item-${item}">
                    <div class="item-info">
                        <i class="fas hover-icon remove-item" id="remove-${item}" style="cursor: pointer;">&#xf057;</i>
                        <img src="https://content.jdmagicbox.com/v2/comp/pandharpur/e5/9999p2186.2186.240102180603.t9e5/catalogue/hotel-royal-shetkari-bhandishegaon-pandharpur-restaurants-m844m8eap3.jpg" alt="" width="50" height="50"/>
                        <div class="item-name">${name}</div>
                    </div>
                    <div class="item-quantity">
                        <button id="minus-${item}" class="btn btn-primary btn-sm minus">-</button>
                        <input type="number" id="val-${item}" class="form-control qty-input" value="${qty}" min="0"/>
                        <button id="plus-${item}" class="btn btn-primary btn-sm plus">+</button>
                    </div>
                    <div class="original-item-price">
                        Rs. ${itemPrice}
                        <div id="price-${item}" class="item-price">Rs. ${sumPrice}</div>
                    </div>
                </li>`;
        }

        $('#items').html(cartItems);
        updateTotalPrice(); // Update total price when initializing
    }

    // Initial call to initialize the cart
    initializeCart(cart);

    // Add functionality for increasing/decreasing quantity
    $('#items').on('click', 'button.minus', function() {
        var id = this.id.split('-')[1];
        cart[id][0] = Math.max(0, cart[id][0] - 1);
        if (cart[id][0] == 0) {
            delete cart[id];
            $(`#item-${id}`).remove(); // Remove the item if quantity is zero
        } else {
            updateCartItem(id); // Update only the specific item
        }
    });

    $('#items').on('click', 'button.plus', function() {
        var id = this.id.split('-')[1];
        cart[id][0] += 1;
        updateCartItem(id); // Update only the specific item
    });

    // Update quantity directly from input field
    $('#items').on('change', 'input.qty-input', function() {
        var id = this.id.split('-')[1];
        var newQty = parseInt(this.value);
        if (newQty > 0) {
            cart[id][0] = newQty;
            updateCartItem(id); // Update only the specific item
        } else {
            delete cart[id];
            $(`#item-${id}`).remove(); // Remove the item if quantity is zero
        }
    });

    // Functionality to remove an item when clicking the remove icon
    $('#items').on('click', '.remove-item', function() {
        var id = this.id.split('-')[1];
        delete cart[id];
        $(`#item-${id}`).remove(); // Remove the item from the UI
        updateTotalPrice(); // Update the total price after removal
    });

    // Prevent form submission if cart is empty
    $('#checkoutForm').on('submit', function(event) {
        if (Object.keys(cart).length === 0) {
            event.preventDefault();
            alert('Your cart is empty. Please add items before checkout.');
        }
    });

    // Refresh button functionality
    $('#refreshCart').on('click', function() {
        initializeCart(cart); // Re-initialize the cart UI on button click
    });

</script>



<script>
    // Get a unique identifier for each cart (based on the URL)
    function getCartKey() {
        var pathname = window.location.pathname; // e.g., /shop/1/
        return 'cart_' + pathname.replace(/\//g, '_'); // e.g., cart__shop_1_
    }

    // Initialize the cart based on the current URL or create a new one
    var cartKey = getCartKey();
    var cart = JSON.parse(localStorage.getItem(cartKey)) || {};

    // Audio element for playing sound
    var soundEffect = new Audio("{% static 'sound/fav.mp3' %}");

    // Update the cart display
    function updateCart() {
        var totalItems = 0;
        var totalPrice = 0;
        var cartItems = '';
        var i = 0;

        for (var item in cart) {
            var name = cart[item][1];
            var qty = cart[item][0];
            var itemPrice = cart[item][2];
            var itemTotal = qty * itemPrice;

            totalItems += qty;
            totalPrice += itemTotal;
            cartItems += `<li class="order-item list-group-item d-flex justify-content-between align-items-center">
                <div class="item-info">
                    <i class="fas hover-icon remove-item" id="delete${item}" style="cursor: pointer;">&#xf057;</i>
                    <img src="https://content.jdmagicbox.com/v2/comp/pandharpur/e5/9999p2186.2186.240102180603.t9e5/catalogue/hotel-royal-shetkari-bhandishegaon-pandharpur-restaurants-m844m8eap3.jpg" alt="" width="30" height="30"/>
                    <div class="item-name"><a href='/shop/search/?search=${name}' class='alert-link'><span>${++i}: ${name}</span></a></div>
                </div>
                <div class="item-quantity">
                    <button id="decrease${item}" class="btn btn-primary btn-sm decrease">-</button>
                    <input type="number" id="val-${item}" class="form-control qty-input" value="${qty}" min="0"/>
                    <button id="increase${item}" class="btn btn-primary btn-sm increase">+</button>
                </div>
                <div class="original-item-price">
                    Rs. ${itemPrice}
                    <div class="item-price">Rs. ${itemTotal}</div>
                </div>
            </li>`;
        }

        cartItems += `<li class="list-group-item d-flex justify-content-between align-items-center" style="background: bisque;">
            <span>TOTAL PRICE:</span>
            <span class="badge badge-danger badge-pill" id="totalPrice">Rs. ${totalPrice} /-</span>
        </li>`;

        $('#items').html(cartItems);
        localStorage.setItem(cartKey, JSON.stringify(cart));
        $('#itemsJson').val(JSON.stringify(cart));
        $('#amount').val(totalPrice);
    }

    // Event listeners for cart buttons
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('cart')) {
            var idstr = event.target.id.toString().slice(2);
            if (cart[idstr]) {
                cart[idstr][0] += 1;
                showNotification(cart[idstr][1] + " quantity increased to " + cart[idstr][0]);
            } else {
                var name = document.getElementById('namepr' + idstr).innerHTML;
                var price = parseInt(document.getElementById('pricepr' + idstr).innerText.replace('Rs. ', '').replace(' /-', ''));
                cart[idstr] = [1, name, price];
                showNotification(cart[idstr][1] + " added to cart");
            }

            // Play the sound effect when the product is added to the cart
            soundEffect.play();

            updateCart();
        }
    });

    // Add and remove item functionality
    $('#items').on('click', 'button.decrease', function() {
        var id = this.id.slice(8);
        if (cart[id]) {
            cart[id][0] = Math.max(0, cart[id][0] - 1);
            if (cart[id][0] === 0) {
                delete cart[id];
            }
            updateCart();
        }
    });

    $('#items').on('click', 'button.increase', function() {
        var id = this.id.slice(8);
        if (cart[id]) {
            cart[id][0] += 1;
            updateCart();
        }
    });

    // Update quantity directly from input
    $('#items').on('change', 'input.qty-input', function() {
        var id = this.id.slice(3);
        var newQty = parseInt(this.value);
        if (newQty > 0) {
            cart[id][0] = newQty;
        } else {
            delete cart[id];
        }
        updateCart();
    });

    // Delete item
    $('#items').on('click', 'i.remove-item', function() {
        var id = this.id.slice(6);
        delete cart[id];
        updateCart();
    });

    // Prevent form submission if cart is empty
    $('#checkoutForm').on('submit', function(event) {
        if (Object.keys(cart).length === 0) {
            event.preventDefault();
            alert('Your cart is empty. Please add items to your cart before checking out.');
        }
    });

    // Handle form submission success
    {% if messages %}
        {% for message in messages %}
            alert('{{ message }}');
        {% endfor %}
        localStorage.removeItem(cartKey);
        updateCart();
    {% endif %}

    // Function to show notifications
    function showNotification(message) {
        var notification = document.getElementById('notification');
        notification.innerText = message;
        notification.style.display = 'block';
        setTimeout(function() {
            notification.style.display = 'none';
        }, 1000);
    }

    // Audio element for playing sound
var soundEffects2 = new Audio("{% static 'sound/90s-game-ui-6-185099.mp3' %}");


$('#clearCart').on('click', function() {
    // Custom confirm dialog using the built-in confirm function
    const userConfirmed = confirm('Are you sure you want to clear the cart? This action cannot be undone.');

    if (userConfirmed) {
        // Proceed to clear the cart if the user clicks 'OK'
        cart = {};
        localStorage.removeItem(cartKey);
        $('#items').html('');        // Clear the cart items display
        $('#totalPrice').html('Rs. 0'); // Reset total price to Rs. 0
        alert('Your cart has been cleared.');
        
        soundEffects2.play();

        // Reset background colors (removes the red background or any custom background)
        $('.menu-item').css('background-color', '');  // Reset product button backgrounds
        $('.category').css('background-color', '');   // Reset category backgrounds
    } else {
        // If user clicks 'Cancel', no action is taken
        alert('Cart clearing was cancelled.');
    }
});

var soundEffect1 = new Audio("{% static 'sound/mausklick-82774.mp3' %}");

$('#refreshPage').on('click', function() {
    soundEffect1.play();
    
    setTimeout(function() {
        location.reload(); // Refresh the page after 500ms
    }, 500); 

    // Optionally, reset background colors before the refresh
    $('.menu-item').css('background-color', '');  // Reset product button backgrounds
    $('.category').css('background-color', '');   // Reset category backgrounds
});


updateCart();

</script>

    
    
{% endblock %}
